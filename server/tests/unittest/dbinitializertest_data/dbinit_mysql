CREATE TABLE SchemaVersionTable (version INTEGER NOT NULL DEFAULT 0)
                                COLLATE=utf8_general_ci DEFAULT CHARSET=utf8

CREATE TABLE ResourceTable (id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
                            name VARBINARY(255) NOT NULL UNIQUE,
                            isVirtual BOOL DEFAULT false)
                            COLLATE=utf8_general_ci DEFAULT CHARSET=utf8

CREATE TABLE CollectionTable (id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
                              remoteId VARBINARY(255),
                              remoteRevision VARBINARY(255),
                              name VARBINARY(255) NOT NULL,
                              parentId BIGINT,
                              resourceId BIGINT NOT NULL,
                              subscribed BOOL NOT NULL DEFAULT true,
                              cachePolicyInherit BOOL NOT NULL DEFAULT true,
                              cachePolicyCheckInterval INTEGER NOT NULL DEFAULT -1,
                              cachePolicyCacheTimeout INTEGER NOT NULL DEFAULT -1,
                              cachePolicySyncOnDemand BOOL NOT NULL DEFAULT false,
                              cachePolicyLocalParts VARBINARY(255),
                              queryString VARBINARY(32768),
                              queryLanguage VARBINARY(255),
                              FOREIGN KEY (parentId) REFERENCES CollectionTable(id) ON DELETE CASCADE ON UPDATE CASCADE,
                              FOREIGN KEY (resourceId) REFERENCES ResourceTable(id) ON DELETE CASCADE ON UPDATE CASCADE)
                              COLLATE=utf8_general_ci DEFAULT CHARSET=utf8

CREATE UNIQUE INDEX CollectionTable_parentAndNameIndex ON CollectionTable (parentId,name)

CREATE TABLE MimeTypeTable (id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
                            name VARBINARY(255) NOT NULL UNIQUE)
                            COLLATE=utf8_general_ci DEFAULT CHARSET=utf8

CREATE TABLE PimItemTable (id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
                           rev INTEGER NOT NULL DEFAULT 0,
                           remoteId VARBINARY(255),
                           remoteRevision VARBINARY(255),
                           collectionId BIGINT,
                           mimeTypeId BIGINT,
                           datetime TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                           atime TIMESTAMP,
                           dirty BOOL,
                           size BIGINT NOT NULL DEFAULT 0,
                           FOREIGN KEY (collectionId) REFERENCES CollectionTable(id) ON DELETE CASCADE ON UPDATE CASCADE,
                           FOREIGN KEY (mimeTypeId) REFERENCES MimeTypeTable(id) ON DELETE CASCADE ON UPDATE CASCADE)
                           COLLATE=utf8_general_ci DEFAULT CHARSET=utf8

CREATE INDEX PimItemTable_collectionIndex ON PimItemTable (collectionId)

CREATE TABLE FlagTable (id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
                        name VARBINARY(255) NOT NULL UNIQUE)
                        COLLATE=utf8_general_ci DEFAULT CHARSET=utf8

CREATE TABLE PartTable (id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
                        pimItemId BIGINT NOT NULL,
                        name VARBINARY(255) NOT NULL,
                        data LONGBLOB,
                        datasize BIGINT NOT NULL,
                        version INTEGER DEFAULT 0,
                        external BOOL DEFAULT false,
                        FOREIGN KEY (pimItemId) REFERENCES PimItemTable(id) ON DELETE CASCADE ON UPDATE CASCADE)
                        COLLATE=utf8_general_ci DEFAULT CHARSET=utf8

CREATE UNIQUE INDEX PartTable_pimItemIdNameIndex ON PartTable (pimItemId,name)

CREATE INDEX PartTable_pimItemNameIndex ON PartTable (name)

CREATE TABLE CollectionAttributeTable (id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
                                       collectionId BIGINT NOT NULL,
                                       type LONGBLOB NOT NULL,
                                       value LONGBLOB,
                                       FOREIGN KEY (collectionId) REFERENCES CollectionTable(id) ON DELETE CASCADE ON UPDATE CASCADE)
                                       COLLATE=utf8_general_ci DEFAULT CHARSET=utf8

CREATE INDEX CollectionAttributeTable_collectionIndex ON CollectionAttributeTable (collectionId)

CREATE TABLE PimItemFlagRelation (PimItem_id INTEGER REFERENCES PimItemTable(id),
                                  Flag_id INTEGER REFERENCES FlagTable(id),
                                  PRIMARY KEY (PimItem_id, Flag_id))

CREATE TABLE CollectionMimeTypeRelation (Collection_id INTEGER REFERENCES CollectionTable(id),
                                         MimeType_id INTEGER REFERENCES MimeTypeTable(id),
                                         PRIMARY KEY (Collection_id, MimeType_id))

CREATE TABLE CollectionPimItemRelation (Collection_id INTEGER REFERENCES CollectionTable(id),
                                        PimItem_id INTEGER REFERENCES PimItemTable(id), PRIMARY KEY (Collection_id, PimItem_id))
